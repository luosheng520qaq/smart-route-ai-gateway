# SmartRoute AI Gateway

[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python](https://img.shields.io/badge/Python-3.10%2B-blue)](https://www.python.org/)
[![React](https://img.shields.io/badge/React-18-cyan)](https://react.dev/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.109%2B-green)](https://fastapi.tiangolo.com/)

ä¸€ä¸ªç°ä»£åŒ–çš„ã€å…¼å®¹ OpenAI åè®®çš„æ™ºèƒ½è·¯ç”±ç½‘å…³ã€‚å®ƒèƒ½æ ¹æ®ç”¨æˆ·æ„å›¾å¤æ‚åº¦è‡ªåŠ¨åˆ†æµè¯·æ±‚ï¼Œæ”¯æŒå¤šæ¨¡å‹æ•…éšœè½¬ç§»ï¼ˆFailoverï¼‰ï¼Œå¹¶æä¾›ç¾è§‚çš„ Web ç®¡ç†é¢æ¿ã€‚

![Dashboard Preview](docs/dashboard-preview.png)

## âœ¨ æ ¸å¿ƒç‰¹æ€§

*   **âš¡ æ™ºèƒ½åˆ†æµ (Intelligent Routing)**:
    *   **T1 (ç®€å•)**: é—²èŠã€çŸ­é—®ç­” -> è·¯ç”±è‡³ä½æˆæœ¬æ¨¡å‹ã€‚
    *   **T2 (ä¸­ç­‰)**: ä»£ç ç”Ÿæˆã€æ–‡æ¡ˆå†™ä½œ -> è·¯ç”±è‡³ä¸­ç­‰æˆæœ¬æ¨¡å‹ã€‚
    *   **T3 (å¤æ‚)**: æ·±åº¦æ¨ç†ã€å¤æ‚é€»è¾‘ -> è·¯ç”±è‡³å¤æ‚æˆæœ¬æ¨¡å‹ã€‚
    *   æ”¯æŒåŸºäº**å…³é”®è¯**çš„å¿«é€ŸåŒ¹é…æˆ–**LLM æ„å›¾è¯†åˆ«**ï¼ˆä½¿ç”¨å°æ¨¡å‹åˆ†æç”¨æˆ·æ„å›¾ï¼‰ã€‚

*   **ğŸ›¡ï¸ é«˜å¯ç”¨ä¸å®¹é”™ (High Availability)**:
    *   **æ™ºèƒ½å¥åº·æ£€æŸ¥**: å¼•å…¥**æ—¶é—´è¡°å‡ä¸åŠ¨æ€æƒ©ç½šæœºåˆ¶**ï¼Œæ¨¡å‹é”™è¯¯åˆ†å€¼ä¼šéšæ—¶é—´è‡ªåŠ¨æ¢å¤ï¼Œå¶å‘é”™è¯¯ä¸ä¼šå¯¼è‡´æ¨¡å‹æ°¸ä¹…è¢« banã€‚
    *   **è‡ªåŠ¨æ•…éšœè½¬ç§»**: å½“ä¸»æ¨¡å‹è¿”å› 4xx/5xx é”™è¯¯æˆ–è¶…æ—¶ï¼Œè‡ªåŠ¨æ— ç¼åˆ‡æ¢åˆ°å¤‡ç”¨æ¨¡å‹ã€‚
    *   **å…³é”®è¯é‡è¯•**: å³ä½¿çŠ¶æ€ç ä¸º 200ï¼Œè‹¥è¿”å›å†…å®¹åŒ…å« "rate limit", "overloaded" ç­‰å…³é”®è¯ï¼Œä¹Ÿä¼šè‡ªåŠ¨é‡è¯•ã€‚
    *   **å‚æ•°è‡ªé€‚åº”**: æ”¯æŒä¸ºä¸åŒæ¨¡å‹é…ç½®ç‰¹å®šçš„é»˜è®¤å‚æ•°ï¼ˆå¦‚ Kimi å¼ºåˆ¶ `top_p=0.95`ï¼‰ï¼Œè§£å†³ä¸Šæ¸¸å…¼å®¹æ€§é—®é¢˜ã€‚

*   **ğŸ”’ ä¼ä¸šçº§å®‰å…¨ (Enterprise Security)**:
    *   **JWT è®¤è¯**: ç®¡ç†åå°å…¨ç«™é‡‡ç”¨ JWT ä»¤ç‰Œè®¤è¯ï¼Œæ”¯æŒä¼šè¯ç®¡ç†ã€‚
    *   **2FA åŒé‡éªŒè¯**: æ”¯æŒ Google Authenticator / TOTP åŠ¨æ€éªŒè¯ç ï¼Œä¿æŠ¤åå°å®‰å…¨ã€‚
    *   **è®¿é—®æ§åˆ¶**: ç»†ç²’åº¦çš„ Gateway API Key æ§åˆ¶ï¼Œç¡®ä¿ API è°ƒç”¨å®‰å…¨ã€‚

*   **ğŸ“Š å¯è§†åŒ–ç®¡ç†é¢æ¿**:
    *   **å®æ—¶ç›‘æ§**: QPSã€å¹³å‡å“åº”æ—¶é—´ã€é”™è¯¯ç‡ã€æ¨¡å‹ä½¿ç”¨åˆ†å¸ƒã€‚
    *   **æ—¥å¿—å®¡è®¡**: å®Œæ•´è®°å½•è¯·æ±‚/å“åº”ä½“ï¼ˆJSONï¼‰ï¼Œæ”¯æŒæµå¼å“åº”é‡ç»„è®°å½•ã€‚
    *   **åœ¨çº¿é…ç½®**: éšæ—¶è°ƒæ•´æ¨¡å‹åˆ—è¡¨ã€è¶…æ—¶æ—¶é—´ã€è·¯ç”±ç­–ç•¥ï¼Œæ— éœ€é‡å¯æœåŠ¡ã€‚

*   **ğŸ”Œ å…¼å®¹æ€§**:
    *   å®Œå…¨å…¼å®¹ OpenAI `/v1/chat/completions` åè®®ã€‚
    *   æ”¯æŒæµå¼ï¼ˆStreamï¼‰ä¸éæµå¼å“åº”ã€‚
    *   æ”¯æŒè‡ªå®šä¹‰ç½‘å…³é‰´æƒï¼ˆGateway API Keyï¼‰ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

- Python 3.10+
- Node.js 18+ (ä»…å‰ç«¯æ„å»ºéœ€è¦)

### 2. åç«¯éƒ¨ç½²

```bash
cd backend
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
# æ¿€æ´»ç¯å¢ƒ (Windows)
venv\Scripts\activate
# æ¿€æ´»ç¯å¢ƒ (Linux/Mac)
source venv/bin/activate

# å®‰è£…ä¾èµ– (æ³¨æ„ï¼šåŒ…å«å®‰å…¨ç»„ä»¶)
pip install -r requirements.txt
```

### 3. å‰ç«¯æ„å»º

```bash
cd frontend
npm install
npm run build
```
æ„å»ºäº§ç‰©ä¼šè‡ªåŠ¨ç”Ÿæˆåˆ° `frontend/dist`ï¼Œåç«¯å°†è‡ªåŠ¨æ‰˜ç®¡ã€‚

### 4. å¯åŠ¨æœåŠ¡

```bash
cd backend
python main.py
```
æœåŠ¡é»˜è®¤è¿è¡Œåœ¨ `http://0.0.0.0:6688`ã€‚

## ğŸ” é»˜è®¤è´¦å·ä¸å®‰å…¨

ç³»ç»Ÿé‡‡ç”¨**é¦–æ¬¡ç™»å½•æ³¨å†Œåˆ¶**ï¼Œæ²¡æœ‰é¢„è®¾å¯†ç ã€‚

1. **é»˜è®¤è´¦å·**: `admin`
2. **é»˜è®¤å¯†ç **: **é¦–æ¬¡ç™»å½•æ—¶è¾“å…¥çš„ä»»æ„å¯†ç **ï¼ˆç³»ç»Ÿä¼šè‡ªåŠ¨å°†å…¶æ³¨å†Œä¸ºæ°¸ä¹…å¯†ç ï¼‰ã€‚
3. **å¼ºçƒˆå»ºè®®**: é¦–æ¬¡ç™»å½•åï¼Œè¯·ç«‹å³å‰å¾€ **ç³»ç»Ÿé…ç½® -> å®‰å…¨è®¾ç½®** å¼€å¯ **2FA åŒé‡éªŒè¯**ã€‚

## ğŸ“ API æ–‡æ¡£

*   **OpenAI ä»£ç†æ¥å£**: `POST /v1/chat/completions`
    *   è®¤è¯: `Authorization: Bearer <Gateway-API-Key>` (å¦‚æœåœ¨è®¾ç½®ä¸­é…ç½®äº† Key)
*   **ç®¡ç†åå° API**: `/api/*`
    *   è®¤è¯: `Authorization: Bearer <JWT-Token>` (é€šè¿‡ç™»å½•è·å–)

## ğŸ”„ æ—§ç‰ˆæœ¬å‡çº§æŒ‡å—

å¦‚æœæ‚¨æ˜¯ä»æ—§ç‰ˆæœ¬å‡çº§ï¼š

1. **å¤‡ä»½æ•°æ®**: å¤‡ä»½ `backend/logs.db` å’Œ `backend/config.json` (å¯é€‰)ã€‚
2. **æ›´æ–°ä»£ç **: è¦†ç›– `backend/` å’Œ `frontend/dist/`ã€‚
3. **æ›´æ–°ä¾èµ–**: åŠ¡å¿…è¿è¡Œ `pip install -r backend/requirements.txt` ä»¥å®‰è£… `passlib`, `python-jose`, `pyotp` ç­‰æ–°ä¾èµ–ã€‚
4. **é‡å¯æœåŠ¡**: æ•°æ®åº“ä¼šè‡ªåŠ¨è¿ç§»ï¼Œæ·»åŠ ç”¨æˆ·è¡¨ã€‚
